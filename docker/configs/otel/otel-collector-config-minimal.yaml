# Minimal OTel Collector Configuration for File-Based Exports
#
# This is the absolute minimum configuration needed to export
# traces, metrics, and logs to files for AI agent verification.
#
# Services required:
#   - OTel Collector ONLY
#
# Services NOT required:
#   - StatsD (broken anyway, use OTLP instead)
#   - Prometheus (optional, for time-series queries)
#   - Grafana (optional, for dashboards)
#   - Jaeger (optional, for trace UI)
#   - Filebeat (optional, for log post-processing)
#
# To use this config:
#   1. Copy to docker/configs/otel/otel-collector-config.yaml
#   2. Restart OTel Collector: docker-compose restart otel-collector
#   3. Send telemetry to localhost:4317 (gRPC) or localhost:4318 (HTTP)
#   4. Check files in ./data/traces/, ./data/metrics/, ./data/logs/

receivers:
  # OTLP receiver - the only required receiver
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  # Batch processor - recommended for efficiency
  batch:
    timeout: 1s
    send_batch_size: 1024
    send_batch_max_size: 2048

exporters:
  # File exporters - these write telemetry to disk
  file/traces:
    path: /data/traces/traces.jsonl
    format: json

  file/metrics:
    path: /data/metrics/metrics.jsonl
    format: json

  file/logs:
    path: /data/logs/logs.jsonl
    format: json

extensions:
  # Health check - recommended for container health checks
  health_check:
    endpoint: 0.0.0.0:13133

service:
  extensions: [health_check]

  pipelines:
    # Traces pipeline: OTLP → Batch → File
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [file/traces]

    # Metrics pipeline: OTLP → Batch → File
    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [file/metrics]

    # Logs pipeline: OTLP → Batch → File
    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [file/logs]

  telemetry:
    logs:
      level: "info"
